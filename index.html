<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSSP SOC Platform - Enterprise Security Operations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0066cc; --secondary: #004080; --success: #28a745;
            --warning: #ffc107; --danger: #dc3545; --info: #17a2b8;
            --dark-bg: #1a1a2e; --card-bg: #16213e; --text-primary: #ffffff;
            --text-secondary: #b8b8b8; --border: #2d3748;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--text-primary); line-height: 1.6; min-height: 100vh;
        }
        
        .container { max-width: 1900px; margin: 0 auto; padding: 15px; }
        
        header {
            background: var(--card-bg); padding: 15px 20px; border-radius: 8px;
            margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-left: 4px solid var(--primary); display: flex;
            justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;
        }
        
        header h1 { font-size: 20px; color: var(--primary); }
        header p { font-size: 11px; color: var(--text-secondary); margin-top: 3px; }
        
        .tenant-controls {
            display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
        }
        
        .tenant-controls select {
            padding: 8px 12px; background: var(--dark-bg);
            border: 2px solid var(--border); border-radius: 6px;
            color: var(--text-primary); font-size: 13px; min-width: 180px;
        }
        
        .tabs {
            display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 8px 16px; background: var(--card-bg);
            border: 2px solid var(--border); color: var(--text-primary);
            cursor: pointer; border-radius: 6px; font-size: 12px;
            font-weight: 600; transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background: var(--primary); border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: var(--primary); border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,102,204,0.4);
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px; margin-bottom: 15px;
        }
        
        .widget {
            background: var(--card-bg); padding: 18px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-left: 4px solid var(--primary); cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .widget:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        
        .widget h3 { font-size: 14px; margin-bottom: 12px; color: var(--primary); }
        .widget-value { font-size: 32px; font-weight: bold; margin-bottom: 8px; }
        .widget-label { font-size: 11px; color: var(--text-secondary); }
        
        .severity-breakdown {
            display: flex; gap: 8px; margin-top: 12px;
        }
        
        .severity-item {
            flex: 1; text-align: center; padding: 8px;
            background: rgba(255,255,255,0.05); border-radius: 6px;
        }
        
        .severity-item .count { font-size: 20px; font-weight: bold; }
        .severity-item .label { font-size: 10px; margin-top: 4px; }
        
        .critical { color: #dc3545; }
        .high { color: #fd7e14; }
        .medium { color: #ffc107; }
        .low { color: #28a745; }
        
        .customer-card {
            background: var(--card-bg); padding: 18px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-left: 4px solid var(--info); cursor: pointer;
            transition: all 0.3s ease; margin-bottom: 12px;
        }
        
        .customer-card:hover {
            transform: translateX(5px); border-left-color: var(--success);
        }
        
        .customer-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 12px;
        }
        
        .customer-name { font-size: 16px; font-weight: bold; }
        
        .status-badge {
            padding: 4px 10px; border-radius: 12px;
            font-size: 10px; font-weight: 600;
        }
        
        .status-active {
            background: rgba(40,167,69,0.2); color: var(--success);
            border: 1px solid var(--success);
        }
        
        .status-inactive {
            background: rgba(220,53,69,0.2); color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        .form-section {
            background: var(--card-bg); padding: 18px; border-radius: 8px;
            margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .form-section h3 {
            margin-bottom: 12px; color: var(--primary); font-size: 15px;
        }
        
        .form-group { margin-bottom: 12px; }
        
        .form-group label {
            display: block; margin-bottom: 5px; font-weight: 600; font-size: 12px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 9px; background: var(--dark-bg);
            border: 2px solid var(--border); border-radius: 6px;
            color: var(--text-primary); font-size: 12px;
        }
        
        .form-group textarea {
            min-height: 90px; resize: vertical; font-family: 'Courier New', monospace;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .btn {
            padding: 9px 20px; border: none; border-radius: 6px;
            cursor: pointer; font-size: 12px; font-weight: 600;
            transition: all 0.3s ease; display: inline-flex;
            align-items: center; gap: 6px;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: #000; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .button-group {
            display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;
        }
        
        .alert {
            padding: 10px 15px; border-radius: 6px; margin-bottom: 12px;
            display: none; animation: slideIn 0.3s ease;
        }
        
        .alert.show { display: block; }
        .alert-success { background: rgba(40,167,69,0.2); border-left: 4px solid var(--success); }
        .alert-danger { background: rgba(220,53,69,0.2); border-left: 4px solid var(--danger); }
        .alert-warning { background: rgba(255,193,7,0.2); border-left: 4px solid var(--warning); }
        .alert-info { background: rgba(23,162,184,0.2); border-left: 4px solid var(--info); }
        
        .two-column {
            display: grid; grid-template-columns: 1fr 2fr; gap: 15px;
        }
        
        .incident-card {
            background: rgba(255,255,255,0.05); padding: 12px;
            margin-bottom: 10px; border-radius: 6px;
            border-left: 4px solid var(--info); cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .incident-card:hover {
            background: rgba(255,255,255,0.1); transform: translateX(5px);
        }
        
        .incident-card.selected {
            border-left-color: var(--success);
            background: rgba(40,167,69,0.1);
        }
        
        .kpi-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(0,102,204,0.1) 100%);
            padding: 18px; border-radius: 8px; text-align: center;
            border: 2px solid var(--border);
        }
        
        .kpi-value {
            font-size: 36px; font-weight: bold; color: var(--primary);
            margin-bottom: 5px;
        }
        
        .kpi-label {
            font-size: 12px; color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .kpi-trend { font-size: 11px; margin-top: 6px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.85);
            z-index: 1000; align-items: center; justify-content: center;
            overflow-y: auto; padding: 20px;
        }
        
        .modal.show { display: flex; }
        
        .modal-content {
            background: var(--card-bg); padding: 25px; border-radius: 10px;
            max-width: 900px; width: 100%; max-height: 90vh;
            overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 2px solid var(--border);
        }
        
        .modal-header h2 { color: var(--primary); font-size: 18px; }
        
        .close-btn {
            background: var(--danger); color: white; border: none;
            padding: 6px 12px; border-radius: 6px; cursor: pointer;
            font-size: 12px; font-weight: 600;
        }
        
        .preview-section {
            background: white; color: #000; padding: 25px;
            border-radius: 8px; margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .preview-section h2 {
            color: var(--primary); border-bottom: 3px solid var(--primary);
            padding-bottom: 10px; margin-bottom: 15px; font-size: 20px;
        }
        
        .preview-section h3 {
            color: var(--secondary); margin-top: 20px;
            margin-bottom: 12px; font-size: 16px;
        }
        
        .preview-section table {
            width: 100%; border-collapse: collapse; margin: 12px 0;
        }
        
        .preview-section table th, .preview-section table td {
            padding: 10px; border: 1px solid #ddd; text-align: left;
            font-size: 13px;
        }
        
        .preview-section table th {
            background: var(--primary); color: white; font-weight: 600;
        }
        
        .loading-spinner {
            display: inline-block; width: 18px; height: 18px;
            border: 3px solid rgba(255,255,255,0.3); border-radius: 50%;
            border-top-color: var(--primary); animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .metric-row {
            display: flex; justify-content: space-between; padding: 10px;
            background: rgba(255,255,255,0.03); margin-bottom: 6px;
            border-radius: 6px; font-size: 12px;
        }
        
        .metric-label { font-weight: 600; }
        .metric-value { font-weight: bold; color: var(--success); }
        
        .clickable { cursor: pointer; transition: all 0.2s ease; }
        .clickable:hover { color: var(--primary); text-decoration: underline; }
        
        @media (max-width: 1200px) {
            .two-column { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        }
        
        .saved-customers-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px; margin-top: 15px;
        }
        
        .saved-customer-item {
            background: rgba(255,255,255,0.05); padding: 12px;
            border-radius: 6px; border-left: 3px solid var(--success);
            font-size: 12px;
        }
        
        .saved-customer-item .name { font-weight: bold; margin-bottom: 5px; }
        .saved-customer-item .meta { font-size: 10px; color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>üõ°Ô∏è MSSP SOC Platform - Enterprise Security Operations Center</h1>
                <p>Multi-Tenant Security Operations | AI-Powered Analysis | Real-time Threat Intelligence</p>
            </div>
            <div class="tenant-controls">
                <label style="font-weight: 600; font-size: 12px;">Customer:</label>
                <select id="tenantSelector" onchange="switchTenant()">
                    <option value="all">üåê All Customers (MSSP View)</option>
                </select>
                <button class="btn btn-success" onclick="showOnboardModal()">‚ûï Onboard Customer</button>
                <button class="btn btn-danger" onclick="showOffboardModal()">‚ûñ Offboard Customer</button>
            </div>
        </header>

        <div id="alert-container"></div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('mssp-dashboard')">üåê MSSP Dashboard</button>
            <button class="tab-button" onclick="switchTab('ciso-dashboard')">üìä CISO Dashboard</button>
            <button class="tab-button" onclick="switchTab('analyst-view')">üë®‚Äçüíª Analyst Workspace</button>
            <button class="tab-button" onclick="switchTab('manager-view')">üëî SOC Manager</button>
            <button class="tab-button" onclick="switchTab('incidents')">üö® Incidents</button>
            <button class="tab-button" onclick="switchTab('customers')">üë• Customers</button>
        </div>

        <!-- MSSP Dashboard -->
        <div id="mssp-dashboard" class="tab-content active">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">Multi-Tenant Security Overview</h2>
            
            <div class="dashboard-grid">
                <div class="widget" onclick="navigateToCustomers()">
                    <h3>Total Customers</h3>
                    <div class="widget-value" id="totalCustomers">0</div>
                    <div class="widget-label">Active Tenants</div>
                </div>
                <div class="widget" onclick="navigateToIncidents()">
                    <h3>Total Incidents</h3>
                    <div class="widget-value" id="totalIncidents">0</div>
                    <div class="widget-label">Across All Customers</div>
                </div>
                <div class="widget" onclick="navigateToCritical()">
                    <h3>Critical Alerts</h3>
                    <div class="widget-value critical" id="criticalAlerts">0</div>
                    <div class="widget-label">Requires Immediate Action</div>
                </div>
                <div class="widget">
                    <h3>Automation Rate</h3>
                    <div class="widget-value" style="color: var(--success);" id="automationRate">0%</div>
                    <div class="widget-label">Auto-Resolved Cases</div>
                </div>
            </div>

            <h3 style="margin: 20px 0 12px; color: var(--primary); font-size: 16px;">Customer Tenants</h3>
            <div id="customersList"></div>
        </div>

        <!-- CISO Dashboard -->
        <div id="ciso-dashboard" class="tab-content">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">
                CISO Executive Dashboard - <span id="cisoTenantName">Select Customer</span>
            </h2>

            <div class="dashboard-grid">
                <div class="kpi-card">
                    <div class="kpi-value">2.3h</div>
                    <div class="kpi-label">Mean Time to Respond</div>
                    <div class="kpi-trend trend-up">‚Üì 15% vs last month</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">82%</div>
                    <div class="kpi-label">Auto-Resolved Rate</div>
                    <div class="kpi-trend trend-up">‚Üë 8% improvement</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">94%</div>
                    <div class="kpi-label">SOC Efficiency</div>
                    <div class="kpi-trend trend-up">‚Üë 12% vs manual</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">78%</div>
                    <div class="kpi-label">MITRE Coverage</div>
                    <div class="kpi-trend trend-up">‚Üë 5% this quarter</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                <div class="form-section">
                    <h3>üéØ Security Posture</h3>
                    <div class="metric-row">
                        <span class="metric-label">Overall Health Score</span>
                        <span class="metric-value">87/100</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Active Threats</span>
                        <span class="metric-value" style="color: var(--danger);">23</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Compliance Status</span>
                        <span class="metric-value">92%</span>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üì° Data Sources</h3>
                    <div class="metric-row">
                        <span class="metric-label">Total Integrated</span>
                        <span class="metric-value">12</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Online</span>
                        <span class="metric-value">11</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Issues</span>
                        <span class="metric-value" style="color: var(--warning);">1</span>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ü§ñ Automation</h3>
                    <div class="metric-row">
                        <span class="metric-label">Playbooks Active</span>
                        <span class="metric-value">45</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Success Rate</span>
                        <span class="metric-value">95.3%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Time Saved</span>
                        <span class="metric-value">82%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analyst Workspace -->
        <div id="analyst-view" class="tab-content">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">
                SOC Analyst Workspace - <span id="analystTenantName">Select Customer</span>
            </h2>

            <div class="two-column">
                <div class="form-section">
                    <h3>üìã My Queue</h3>
                    <div id="analystQueue" style="max-height: 600px; overflow-y: auto;"></div>
                </div>

                <div class="form-section">
                    <h3>ü§ñ AI-Powered Analysis</h3>
                    <div id="aiAnalysisPanel">
                        <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            Select an incident to view AI analysis
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOC Manager View -->
        <div id="manager-view" class="tab-content">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">
                SOC Manager Dashboard - <span id="managerTenantName">Select Customer</span>
            </h2>

            <div class="dashboard-grid">
                <div class="widget">
                    <h3>Team Performance</h3>
                    <div class="widget-value">94%</div>
                    <div class="widget-label">SLA Compliance</div>
                </div>
                <div class="widget">
                    <h3>Pending Cases</h3>
                    <div class="widget-value">23</div>
                    <div class="widget-label">In Queue</div>
                </div>
                <div class="widget">
                    <h3>Avg Resolution Time</h3>
                    <div class="widget-value">2.3h</div>
                    <div class="widget-label">MTTR</div>
                </div>
                <div class="widget">
                    <h3>Analyst Efficiency</h3>
                    <div class="widget-value">87%</div>
                    <div class="widget-label">Productivity Score</div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä Team Workload Distribution</h3>
                <div class="metric-row">
                    <span class="metric-label">Analyst 1 - John Doe</span>
                    <span class="metric-value">8 cases</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Analyst 2 - Jane Smith</span>
                    <span class="metric-value">6 cases</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Analyst 3 - Mike Johnson</span>
                    <span class="metric-value">9 cases</span>
                </div>
            </div>
        </div>

        <!-- Incidents Tab -->
        <div id="incidents" class="tab-content">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">
                Incident Management - <span id="incidentTenantName">Select Customer</span>
            </h2>
            
            <div class="two-column">
                <div class="form-section">
                    <h3>üìã Open Incidents</h3>
                    <div id="incidentsList" style="max-height: 600px; overflow-y: auto;"></div>
                </div>

                <div class="form-section">
                    <h3>ü§ñ AI Analysis & Recommendations</h3>
                    <div id="analysisResults"></div>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;">Customer Management</h2>
            
            <div class="form-section">
                <h3>üíº Saved Customers</h3>
                <div id="savedCustomersList" class="saved-customers-list"></div>
            </div>
        </div>
    </div>

    <!-- Onboard Customer Modal -->
    <div id="onboardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Onboard New Customer</h2>
                <button class="close-btn" onclick="closeOnboardModal()">‚úï Close</button>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Customer Name *</label>
                    <input type="text" id="onboardName" placeholder="Acme Corporation">
                </div>
                <div class="form-group">
                    <label>Tenant ID *</label>
                    <input type="text" id="onboardId" placeholder="acme-corp">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Industry</label>
                    <select id="onboardIndustry">
                        <option value="">Select Industry</option>
                        <option value="finance">Financial Services</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="retail">Retail</option>
                        <option value="technology">Technology</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="government">Government</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Company Size</label>
                    <select id="onboardSize">
                        <option value="">Select Size</option>
                        <option value="small">Small (1-100)</option>
                        <option value="medium">Medium (101-1000)</option>
                        <option value="large">Large (1001-10000)</option>
                        <option value="enterprise">Enterprise (10000+)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>XSIAM Instance URL *</label>
                    <input type="url" id="onboardXsiamUrl" placeholder="https://tenant.xsiam.paloaltonetworks.com">
                </div>
                <div class="form-group">
                    <label>Database Connection *</label>
                    <input type="text" id="onboardDb" placeholder="mongodb://tenant-db:27017/customer_db">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>API Key ID *</label>
                    <input type="text" id="onboardApiKeyId">
                </div>
                <div class="form-group">
                    <label>API Key *</label>
                    <input type="password" id="onboardApiKey">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Primary Contact Name</label>
                    <input type="text" id="onboardContactName" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Primary Contact Email</label>
                    <input type="email" id="onboardContactEmail" placeholder="john.doe@company.com">
                </div>
            </div>
            
            <div class="form-group">
                <label>Notes</label>
                <textarea id="onboardNotes" rows="3" placeholder="Additional information about the customer..."></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn btn-success" onclick="onboardCustomer()">‚úì Onboard Customer</button>
                <button class="btn btn-info" onclick="testConnection()">üîå Test Connection</button>
                <button class="btn btn-danger" onclick="closeOnboardModal()">‚úï Cancel</button>
            </div>
        </div>
    </div>

    <!-- Offboard Customer Modal -->
    <div id="offboardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûñ Offboard Customer</h2>
                <button class="close-btn" onclick="closeOffboardModal()">‚úï Close</button>
            </div>
            
            <div class="form-group">
                <label>Select Customer to Offboard *</label>
                <select id="offboardCustomerSelect" style="width: 100%; padding: 10px;">
                    <option value="">Choose customer...</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Reason for Offboarding</label>
                <textarea id="offboardReason" rows="4" placeholder="Contract ended, migration to in-house SOC, etc."></textarea>
            </div>
            
            <div style="background: rgba(220,53,69,0.1); padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid var(--danger);">
                <strong style="color: var(--danger);">‚ö†Ô∏è Warning:</strong>
                <p style="margin-top: 8px; font-size: 12px;">
                    Offboarding will deactivate the customer but preserve all historical data.
                    This action can be reversed by re-onboarding the customer.
                </p>
            </div>
            
            <div class="button-group">
                <button class="btn btn-danger" onclick="offboardCustomer()">‚ûñ Offboard Customer</button>
                <button class="btn btn-info" onclick="closeOffboardModal()">‚úï Cancel</button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2>üëÅÔ∏è Report Preview</h2>
                <button class="close-btn" onclick="closePreviewModal()">‚úï Close</button>
            </div>
            
            <div id="previewContent" class="preview-section"></div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="sendToCustomer()">üìß Send to Customer</button>
                <button class="btn btn-info" onclick="exportReport()">üíæ Export HTML</button>
                <button class="btn btn-warning" onclick="copyReport()">üìã Copy</button>
                <button class="btn btn-danger" onclick="closePreviewModal()">‚úï Close</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let customers = JSON.parse(localStorage.getItem('mssp_customers') || '{}');
        let currentTenant = 'all';
        let currentIncident = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
            updateDashboard();
        });

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function switchTenant() {
            currentTenant = document.getElementById('tenantSelector').value;
            updateDashboard();
            updateAllViews();
        }

        function loadCustomers() {
            const selector = document.getElementById('tenantSelector');
            const offboardSelect = document.getElementById('offboardCustomerSelect');
            
            // Clear existing options except "All Customers"
            selector.innerHTML = '<option value="all">üåê All Customers (MSSP View)</option>';
            offboardSelect.innerHTML = '<option value="">Choose customer...</option>';
            
            Object.keys(customers).forEach(id => {
                const customer = customers[id];
                if (customer.status === 'active') {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = customer.name;
                    selector.appendChild(option);
                    
                    const offOption = document.createElement('option');
                    offOption.value = id;
                    offOption.textContent = customer.name;
                    offboardSelect.appendChild(offOption);
                }
            });
            
            displayCustomersList();
            displaySavedCustomers();
        }

        function displayCustomersList() {
            const container = document.getElementById('customersList');
            const activeCustomers = Object.entries(customers).filter(([id, c]) => c.status === 'active');
            
            if (activeCustomers.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No customers onboarded yet. Click "Onboard Customer" to add your first customer.</p>';
                return;
            }
            
            container.innerHTML = activeCustomers.map(([id, customer]) => `
                <div class="customer-card" onclick="selectCustomer('${id}')">
                    <div class="customer-header">
                        <div class="customer-name">${getIndustryIcon(customer.industry)} ${customer.name}</div>
                        <span class="status-badge status-active">Active</span>
                    </div>
                    <div class="severity-breakdown">
                        <div class="severity-item">
                            <div class="count critical">${customer.incidents?.critical || 0}</div>
                            <div class="label">Critical</div>
                        </div>
                        <div class="severity-item">
                            <div class="count high">${customer.incidents?.high || 0}</div>
                            <div class="label">High</div>
                        </div>
                        <div class="severity-item">
                            <div class="count medium">${customer.incidents?.medium || 0}</div>
                            <div class="label">Medium</div>
                        </div>
                        <div class="severity-item">
                            <div class="count low">${customer.incidents?.low || 0}</div>
                            <div class="label">Low</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 11px; color: var(--text-secondary);">
                        MTTR: ${customer.mttr || '2.3h'} | Auto-Resolved: ${customer.autoResolved || '82%'} | Data Sources: ${customer.dataSources || 12}
                    </div>
                </div>
            `).join('');
        }

        function displaySavedCustomers() {
            const container = document.getElementById('savedCustomersList');
            const allCustomers = Object.entries(customers);
            
            if (allCustomers.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No customers saved yet.</p>';
                return;
            }
            
            container.innerHTML = allCustomers.map(([id, customer]) => `
                <div class="saved-customer-item">
                    <div class="name">${customer.name}</div>
                    <div class="meta">
                        Status: ${customer.status === 'active' ? '‚úì Active' : '‚úó Inactive'}<br>
                        Industry: ${customer.industry || 'N/A'}<br>
                        Onboarded: ${new Date(customer.onboardedDate).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function getIndustryIcon(industry) {
            const icons = {
                finance: 'üè¶', healthcare: 'üè•', retail: 'üõí',
                technology: 'üíª', manufacturing: 'üè≠', government: 'üèõÔ∏è'
            };
            return icons[industry] || 'üè¢';
        }

        function updateDashboard() {
            const activeCustomers = Object.values(customers).filter(c => c.status === 'active');
            const totalIncidents = activeCustomers.reduce((sum, c) => 
                sum + (c.incidents?.critical || 0) + (c.incidents?.high || 0) + 
                (c.incidents?.medium || 0) + (c.incidents?.low || 0), 0);
            const criticalCount = activeCustomers.reduce((sum, c) => sum + (c.incidents?.critical || 0), 0);
            
            document.getElementById('totalCustomers').textContent = activeCustomers.length;
            document.getElementById('totalIncidents').textContent = totalIncidents;
            document.getElementById('criticalAlerts').textContent = criticalCount;
            document.getElementById('automationRate').textContent = '82%';
        }

        function updateAllViews() {
            const tenantName = customers[currentTenant]?.name || 'Select Customer';
            document.getElementById('cisoTenantName').textContent = tenantName;
            document.getElementById('analystTenantName').textContent = tenantName;
            document.getElementById('managerTenantName').textContent = tenantName;
            document.getElementById('incidentTenantName').textContent = tenantName;
            
            if (currentTenant !== 'all') {
                loadIncidents(currentTenant);
            }
        }

        function selectCustomer(tenantId) {
            currentTenant = tenantId;
            document.getElementById('tenantSelector').value = tenantId;
            updateAllViews();
            switchTab('incidents');
        }

        function loadIncidents(tenantId) {
            const mockIncidents = [
                {
                    id: 'INC-2025-001234', severity: 'Critical', status: 'New',
                    alertName: 'Ransomware Activity Detected',
                    host: 'SERVER-XYZ456', time: '2 hours ago'
                },
                {
                    id: 'INC-2025-001235', severity: 'High', status: 'In Progress',
                    alertName: 'Suspicious PowerShell Execution',
                    host: 'DESKTOP-ABC123', time: '4 hours ago'
                },
                {
                    id: 'INC-2025-001236', severity: 'Medium', status: 'New',
                    alertName: 'Brute Force Login Attempt',
                    host: 'WEB-SERVER-01', time: '6 hours ago'
                }
            ];
            
            const container = document.getElementById('incidentsList');
            const queueContainer = document.getElementById('analystQueue');
            
            const html = mockIncidents.map(inc => `
                <div class="incident-card" onclick="analyzeIncident('${inc.id}')">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <strong>${inc.id}</strong>
                        <span class="status-badge" style="background: rgba(220,53,69,0.2); color: var(--danger);">${inc.severity}</span>
                    </div>
                    <div style="font-size: 12px;">${inc.alertName}</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">
                        Host: ${inc.host} | ${inc.time}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
            if (queueContainer) queueContainer.innerHTML = html;
        }

        async function analyzeIncident(incidentId) {
            currentIncident = incidentId;
            const panel = document.getElementById('analysisResults') || document.getElementById('aiAnalysisPanel');
            
            panel.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading-spinner"></div><p>AI analyzing incident...</p></div>';
            
            // Simulate AI analysis
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const analysis = generateAIAnalysis(incidentId);
            
            panel.innerHTML = `
                <div style="background: rgba(23,162,184,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--info);">
                    <h4 style="color: var(--info); margin-bottom: 15px;">ü§ñ AI-Powered Analysis: ${incidentId}</h4>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>Classification:</strong> ${analysis.classification}<br>
                        <strong>Confidence:</strong> ${analysis.confidence}<br>
                        <strong>MITRE ATT&CK:</strong> ${analysis.mitre}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üìã Observations:</strong>
                        <p style="margin-top: 8px; font-size: 12px;">${analysis.observations}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üîç Key Findings:</strong>
                        <p style="margin-top: 8px; font-size: 12px;">${analysis.findings}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>üíº Business Impact:</strong>
                        <p style="margin-top: 8px; font-size: 12px;">${analysis.businessImpact}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>‚úÖ Recommendations:</strong>
                        <p style="margin-top: 8px; font-size: 12px; white-space: pre-line;">${analysis.recommendations}</p>
                    </div>
                    
                    <div class="button-group" style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="showPreview()">üëÅÔ∏è Preview Report</button>
                        <button class="btn btn-primary" onclick="updateIncidentStatus()">‚úì Update Status</button>
                        <button class="btn btn-info" onclick="exportAnalysis()">üíæ Export</button>
                    </div>
                </div>
            `;
            
            showAlert('AI analysis completed successfully', 'success');
        }

        function generateAIAnalysis(incidentId) {
            return {
                classification: 'True Positive - Critical Threat',
                confidence: 'High (98%)',
                mitre: 'T1486 (Data Encrypted for Impact), T1490 (Inhibit System Recovery)',
                observations: 'Multiple file encryption events detected across network shares. Shadow Volume Copies deletion observed. Ransom note files created in multiple directories. Initial access vector identified as phishing email with malicious attachment opened by user john.doe@company.com at 14:23 UTC.',
                findings: 'Ransomware variant identified as LockBit 3.0 based on encryption patterns and ransom note structure. Affected systems: 3 file servers, 12 workstations. Total encrypted files: 1,247. Lateral movement detected using compromised domain credentials. C2 communication established with IP 185.220.101.45 (known malicious infrastructure).',
                businessImpact: 'CRITICAL - Business operations severely impacted. Finance and HR departments unable to access critical documents and databases. Estimated data loss: 2.4 TB if backups unavailable. Potential downtime: 24-48 hours for full recovery. Compliance implications: GDPR breach notification may be required if customer data compromised. Financial impact: Estimated $500K-$1M in recovery costs and business disruption.',
                recommendations: `IMMEDIATE ACTIONS (Next 15 minutes):
1. Isolate all affected systems from network immediately
2. Disable user account: john.doe@company.com
3. Block C2 IP 185.220.101.45 at firewall level
4. Preserve forensic evidence - DO NOT power off systems

FOR NOC TEAM:
- Block outbound traffic from subnet 192.168.10.0/24
- Implement emergency firewall rules to prevent lateral movement
- Monitor for additional C2 communication attempts

FOR IT/ENDPOINT TEAM:
- Initiate backup restoration from last clean backup (verify integrity first)
- Deploy emergency security patches to all systems
- Force password reset for all domain users
- Scan all systems with updated AV signatures

FOR CLOUD TEAM:
- Review cloud storage for encrypted files
- Enable versioning on critical cloud storage
- Verify cloud backup integrity

CRITICAL - DO NOT BLOCK:
- Backup server IPs: 10.0.5.10, 10.0.5.11
- Domain controllers: DC01.company.local, DC02.company.local
- Emergency response tools and admin access
- Business-critical application servers in DMZ`
            };
        }

        function showPreview() {
            const analysis = generateAIAnalysis(currentIncident);
            const customer = customers[currentTenant];
            
            const previewHTML = `
                <h2>üõ°Ô∏è SOC Incident Response Report</h2>
                <table>
                    <tr><th>Incident ID</th><td>${currentIncident}</td><th>Severity</th><td class="critical">Critical</td></tr>
                    <tr><th>Customer</th><td>${customer?.name || 'N/A'}</td><th>Status</th><td>In Progress</td></tr>
                    <tr><th>Detection Time</th><td>${new Date().toLocaleString()}</td><th>Analyst</th><td>SOC Team</td></tr>
                </table>
                
                <h3>ü§ñ AI Analysis Summary</h3>
                <p><strong>Classification:</strong> ${analysis.classification}</p>
                <p><strong>Confidence Level:</strong> ${analysis.confidence}</p>
                <p><strong>MITRE ATT&CK Techniques:</strong> ${analysis.mitre}</p>
                
                <h3>üìã Observations</h3>
                <p>${analysis.observations}</p>
                
                <h3>üîç Key Findings</h3>
                <p>${analysis.findings}</p>
                
                <h3>üíº Business Impact Assessment</h3>
                <p>${analysis.businessImpact}</p>
                
                <h3>‚úÖ Recommendations & Remediation Actions</h3>
                <p style="white-space: pre-line;">${analysis.recommendations}</p>
                
                <hr style="margin: 30px 0;">
                <p style="text-align: center; color: #666; font-size: 11px;">
                    Generated by MSSP SOC Platform | ${new Date().toLocaleString()}<br>
                    Confidential - For Customer Use Only
                </p>
            `;
            
            document.getElementById('previewContent').innerHTML = previewHTML;
            document.getElementById('previewModal').classList.add('show');
        }

        function closePreviewModal() {
            document.getElementById('previewModal').classList.remove('show');
        }

        function sendToCustomer() {
            const customer = customers[currentTenant];
            if (!customer || !customer.contactEmail) {
                showAlert('Customer email not configured', 'warning');
                return;
            }
            
            showAlert(`Report sent to ${customer.contactEmail}`, 'success');
            closePreviewModal();
        }

        function exportReport() {
            const content = document.getElementById('previewContent').innerHTML;
            const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>SOC Report</title><style>body{font-family:Arial;max-width:1000px;margin:40px auto;padding:20px}h2{color:#0066cc;border-bottom:3px solid #0066cc;padding-bottom:10px}h3{color:#004080;margin-top:20px}table{width:100%;border-collapse:collapse;margin:15px 0}th,td{padding:10px;border:1px solid #ddd}th{background:#0066cc;color:white}.critical{color:#dc3545;font-weight:bold}</style></head><body>${content}</body></html>`], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `incident-report-${currentIncident}-${Date.now()}.html`;
            a.click();
            showAlert('Report exported successfully', 'success');
        }

        function copyReport() {
            const content = document.getElementById('previewContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                showAlert('Report copied to clipboard', 'success');
            });
        }

        function updateIncidentStatus() {
            showAlert('Incident status updated in XSIAM', 'success');
        }

        function exportAnalysis() {
            showAlert('Analysis exported successfully', 'success');
        }

        function showOnboardModal() {
            document.getElementById('onboardModal').classList.add('show');
        }

        function closeOnboardModal() {
            document.getElementById('onboardModal').classList.remove('show');
        }

        function showOffboardModal() {
            if (Object.keys(customers).length === 0) {
                showAlert('No customers to offboard', 'warning');
                return;
            }
            document.getElementById('offboardModal').classList.add('show');
        }

        function closeOffboardModal() {
            document.getElementById('offboardModal').classList.remove('show');
        }

        function testConnection() {
            showAlert('Testing connection...', 'info');
            setTimeout(() => {
                showAlert('Connection test successful!', 'success');
            }, 1500);
        }

        function onboardCustomer() {
            const name = document.getElementById('onboardName').value;
            const id = document.getElementById('onboardId').value;
            const industry = document.getElementById('onboardIndustry').value;
            const size = document.getElementById('onboardSize').value;
            const xsiamUrl = document.getElementById('onboardXsiamUrl').value;
            const db = document.getElementById('onboardDb').value;
            const apiKeyId = document.getElementById('onboardApiKeyId').value;
            const apiKey = document.getElementById('onboardApiKey').value;
            const contactName = document.getElementById('onboardContactName').value;
            const contactEmail = document.getElementById('onboardContactEmail').value;
            const notes = document.getElementById('onboardNotes').value;
            
            if (!name || !id || !xsiamUrl || !db || !apiKeyId || !apiKey) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }
            
            customers[id] = {
                name, industry, size, xsiamUrl, db, apiKeyId, apiKey,
                contactName, contactEmail, notes,
                status: 'active',
                onboardedDate: new Date().toISOString(),
                incidents: { critical: 0, high: 0, medium: 0, low: 0 },
                mttr: '2.3h',
                autoResolved: '82%',
                dataSources: 12
            };
            
            localStorage.setItem('mssp_customers', JSON.stringify(customers));
            loadCustomers();
            updateDashboard();
            closeOnboardModal();
            showAlert(`Customer "${name}" onboarded successfully!`, 'success');
            
            // Clear form
            document.getElementById('onboardName').value = '';
            document.getElementById('onboardId').value = '';
            document.getElementById('onboardXsiamUrl').value = '';
            document.getElementById('onboardDb').value = '';
            document.getElementById('onboardApiKeyId').value = '';
            document.getElementById('onboardApiKey').value = '';
            document.getElementById('onboardContactName').value = '';
            document.getElementById('onboardContactEmail').value = '';
            document.getElementById('onboardNotes').value = '';
        }

        function offboardCustomer() {
            const customerId = document.getElementById('offboardCustomerSelect').value;
            const reason = document.getElementById('offboardReason').value;
            
            if (!customerId) {
                showAlert('Please select a customer to offboard', 'danger');
                return;
            }
            
            if (!confirm(`Are you sure you want to offboard ${customers[customerId].name}?`)) {
                return;
            }
            
            customers[customerId].status = 'inactive';
            customers[customerId].offboardedDate = new Date().toISOString();
            customers[customerId].offboardReason = reason;
            
            localStorage.setItem('mssp_customers', JSON.stringify(customers));
            loadCustomers();
            updateDashboard();
            closeOffboardModal();
            showAlert(`Customer offboarded successfully`, 'success');
        }

        function navigateToCustomers() {
            switchTab('customers');
        }

        function navigateToIncidents() {
            switchTab('incidents');
        }

        function navigateToCritical() {
            switchTab('incidents');
        }

        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            container.appendChild(alert);
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>